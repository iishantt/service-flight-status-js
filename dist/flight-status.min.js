/*
 * jQuery Flight Status Widget
 * 2015 Matt O'Connell <mattoconnell408@gmail.com> 
 * License: MIT
 */
 
!function(a,b){"use strict";var c=function(b,c){var e=this;e.$el=a(b).addClass("flight-status"),e.defaults=d,document.body.addEventListener("flightQuerySuccess"),e.async(c,e.makeWidget)},d={urls:{arriving:"https://flysmartapp.com/***/flight/SearchNextArrivingFlights",departing:"https://flysmartapp.com/***/flight/SearchNextDepartingFlights"},airport:null,cacheTime:30,count:10,serverSideScript:"curl.php"};c.prototype.async=function(b,c){var e=this;a.extend(d,b);e.requests={arriving:null,departing:null},e.listen(c),e.pollAPI(b,e.broadcast,"arriving"),e.pollAPI(b,e.broadcast,"departing")},c.prototype.listen=function(a){var b=this;document.body.addEventListener("flightQuerySuccess",function(){var c;for(var d in b.requests)b.requests.hasOwnProperty(d)&&(c=b.requests[d]?!0:!1);c&&a.call(b,b.requests)})},c.prototype.broadcast=function(){document.body.dispatchEvent(new CustomEvent("flightQuerySuccess"))},c.prototype.pollAPI=function(c,e,f){var g=this,h=a.extend(d,c),i=g.makeURL(h,f),j=b?b.get(i,h.cacheTime):!1;if(g.options=h,j)return g.requests[f]=j,e.call(g,j),!1;try{a.ajax({url:h.serverSideScript,data:a.param({url:i,type:"json"}),success:function(a){return a.error?(console.log("Error querying API: ",a.error),!1):(a=JSON.parse(a),b&&b.set(i,a),void(e&&(g.requests[f]=a,e.call(g,a))))},error:function(a){console.log(a)}})}catch(k){console.log(k)}},c.prototype.makeURL=function(a,b){return a.urls[b].replace("***",a.airport)},c.prototype.makeWidget=function(){var b=this,c=b.requests,d=a("<div></div>"),e=a('<div class="toggles"></div>');for(var f in b.requests)if(b.requests.hasOwnProperty(f)){var g="arriving"==f;e.append(a('<span data-toggle="'+f+'">'+f+"</span>"));var h=a('<div data-type="'+f+'"></div>');if(!c[f])return!1;for(var i=c[f].List,j=0;j<b.options.count;j++){var k=g?i[j].DepartureAirportCode:i[j].ArrivalAirportCode,l=i[j].FlightNumber,m="Delayed"==i[j].Status?"delayed":"on-time",n=i[j].Time.split(":"),o=" AM";n[0]>12&&(n[0]=n[0]-12,o=" PM");var p=n.join(":")+o;h.append(a('<div class="flight"><span class="time">'+p+'</span><span class="number '+m+'">'+l+'</span><span class="airport">'+k+"</span></div>"))}d.append(h)}e.prependTo(d),d.find("[data-type]").eq(0).addClass("active"),d.find("[data-toggle]").eq(0).addClass("active"),d.find("[data-toggle]").click(function(){var b=a(this);d.find(".active").removeClass("active");var c=b.addClass("active").data("toggle");d.find('[data-type="'+c+'"]').addClass("active")}),b.$el.append('<p class="title">Flight Status</p>').append(d)},c.prototype.poll=function(a,b){c.prototype.async(a,b)},a.fn.flightStatus=function(a){return this.each(function(){new c(this,a)})},a.extend({flightStatus:c.prototype})}(jQuery,"undefined"!=typeof lsLite?lsLite:null);
//# sourceMappingURL=flight-status.min.js.map